create extension if not exists pgcrypto; create table if not exists users (id uuid primary key default gen_random_uuid(), device_id text unique not null, nickname text not null, created_at timestamptz default now()); create table if not exists runs (id uuid primary key, user_id uuid not null references users(id) on delete cascade, score int not null, wave int not null, duration_ms int not null, season int not null, build_hash text, created_at timestamptz default now()); create table if not exists visits (id bigserial primary key, day date not null, device_id text not null, user_agent text, tz_offset int, created_at timestamptz default now()); create table if not exists nick_reservations (id serial primary key, nickname text unique not null, device_id text not null, created_at timestamptz default now()); create table if not exists run_meta (run_id uuid primary key, device_id text not null, seed int not null, nonce text not null, season int not null, created_at timestamptz default now());
